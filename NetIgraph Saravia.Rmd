---
title: "Network saravia"
author: "Daniel"
date: "19 de julio de 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r igraph}
require(igraph)

# Read Interaction list
#
web <- read.csv("Data/WeddellSea_FW.csv",  header = T,check.names = F)

web <- web[,c(2,1)]

g <- graph_from_data_frame(web)

g

plot(g)


# Igraph functions

E(g)        # The edges of the network
V(g)        # The vertices (species) of the network
V(g)$name   # The names of the species

V(g)[name=="Detritus"]  # Select a vertex by attribute

V(g)[1]    # Select a vertex by id

g[1,]      # Directly access the adjacency matrix

g[,1]      # Directly access the adjacency matrix

deg <- degree(g, mode="all") # calculate the degree for all nodes: the number of edges 
                             # or interactions

deg <- degree(g, mode="in") # calculate the in-degree: the number of preys  


deg <- degree(g, mode="out") # calculate the in-degree: the number of predators 

deg <- degree(g,"Detritus", mode="out") # calculate the in-degree: the number of predators 

deg

# Nicer Plot

plot(g, edge.arrow.size=.4,vertex.label=NA) # Smaller arrow size, not plot names

plot(g, edge.arrow.size=.4,vertex.label=NA,vertex.size=8,layout=layout_with_fr) # Smaller vertex size, specifying a layout 

V(g)$size <- log10(deg)*5+5    # add node degrees to igraph object
V(g)$frame.color <- "white"    # Specify plot options directly on the object 
V(g)$color <- "orange"         #

plot(g, edge.arrow.size=.4,vertex.label=NA,layout=layout_with_lgl)

plot(g, edge.arrow.size=.4,vertex.label=NA, edge.color = "brown", layout=layout_with_lgl)

V(g)$frame.color <- "white"    # Specify plot options directly on the object 
V(g)$color <- "orange"         #
E(g)$color <- "green"         #

plot(g, edge.arrow.size=.4,vertex.label=NA, layout=layout_with_lgl)

```




```{r NetIndices}

require(NetIndices)
require(RColorBrewer)

tl <- TrophInd(get.adjacency(g,sparse = F))

tl[tl$TL>=2,]

# Recordar que TL el el nivel tr√≥pico o nivel de nodo desde hoja a raiz en valor ascendente


# Plot with trophic levels

lMat <-matrix(
  nrow=vcount(g),  # Rows equal to the number of vertices (species)
  ncol=2
)

lMat[,2]<-jitter(tl$TL,0.1)              # y-axis value based on trophic level
lMat[,1]<-runif(vcount(g))   # randomly assign along x-axis

plot(g, edge.width=.3,edge.arrow.size=.4,
       vertex.label=NA,
       edge.color="grey50",
       edge.curved=0.3, layout=lMat)

#tl1 <- tl[tl$TL>1.4,]

#tl2 <- tl1 

#tl2 <- tl2[tl1$TL<1.6,]

#tl2


# Add colors to the plot
#
# require(RColorBrewer)

colTL <-as.numeric(cut(tl$TL,11))   # Divide trophic levels in 11 segments
colnet <- brewer.pal(11,"RdYlGn")   # Assign colors to trophic levels
V(g)$color <- colnet[12-colTL]      # Add colors to the igraph object


plot(g, edge.width=.3,edge.arrow.size=.4,
       vertex.label=NA,
       edge.color="grey50",
       edge.curved=0.3, layout=lMat)


# Read e network

web <- read.csv("Data/WeddellSea_FW.csv",  header = T,check.names = F)

if((ncol(web)-1) == nrow(web)){
  tmp <- web[,2:ncol(web)]
  tmp1 <- as.matrix(tmp)
  g <- graph_from_adjacency_matrix(tmp1)
}else{
  warning("el numero de filas no es igual al numero de columnas")
}



```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
#plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
